(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{501:function(t,a,s){"use strict";s.r(a);var v=s(21),e=Object(v.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("说明：我们用webrtc做视频通话，每次测试都很头疼，2021年的最后一篇文章。")])]),t._v(" "),s("h2",{attrs:{id:"_1-运行本地工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-运行本地工程"}},[t._v("#")]),t._v(" 1.运行本地工程")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228172226534.png",alt:"image-20211228172226534"}})]),t._v(" "),s("p",[t._v("这个工程由nodejs+vue组合")]),t._v(" "),s("p",[t._v("webrtc-main文件夹是一个vue工程，视频通话界面")]),t._v(" "),s("p",[t._v("facewebrtc文件夹是一个nodejs工程，做信令服务器使用")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228172443069.png",alt:"image-20211228172443069"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228172510154.png",alt:"image-20211228172510154"}})]),t._v(" "),s("p",[t._v("vue.config.js配置本机ip")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228172635360.png",alt:"image-20211228172635360"}})]),t._v(" "),s("p",[t._v("开启上位机，开始测试")]),t._v(" "),s("p",[t._v("网站必须是"),s("strong",[t._v("https")]),t._v("，https可以获取到摄像头和麦克风权限，没办法，而且https是针对每台电脑，如果是http的话只能是本机服务器上(nginx所在的电脑)的浏览器可以使用，其他电脑无法使用webrtc，显然这是不合理的，所以不使用http")]),t._v(" "),s("p",[t._v("vue本地调试配置https")]),t._v(" "),s("p",[t._v("nginx要自签名的https，也就是假的https，因为真正的https是需要公网的IP或者域名，我们的视频通话是内网的，所以只能用自签名的证书，假的https打开网页时不受信任，我们需要点击高级，接收风险才行，接受一次就可以了")]),t._v(" "),s("p",[s("strong",[t._v("socketio也要代理，并且接受信任")])]),t._v(" "),s("p",[t._v("先本地调试，调试好了之后就部署到nginx，然后测试，没问题就大功告成！！！")]),t._v(" "),s("p",[t._v("测试需要谷歌浏览器，最新的谷歌浏览器，别的不支持哈！！！")]),t._v(" "),s("h2",{attrs:{id:"_2-使用谷歌浏览器测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用谷歌浏览器测试"}},[t._v("#")]),t._v(" 2.使用谷歌浏览器测试")]),t._v(" "),s("p",[t._v("打开网页获取不到本机ip，需要配置")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228173122012.png",alt:"image-20211228173122012"}})]),t._v(" "),s("p",[t._v("坑啊，为啥会查出多个ip")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228174356891.png",alt:"image-20211228174356891"}})]),t._v(" "),s("p",[t._v("母鸡母鸡啊")]),t._v(" "),s("h2",{attrs:{id:"_3-app嵌入谷歌内核-从执着到放弃"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-app嵌入谷歌内核-从执着到放弃"}},[t._v("#")]),t._v(" 3.App嵌入谷歌内核（从执着到放弃）")]),t._v(" "),s("p",[t._v("卧槽，谷歌内核有38M的SDK，人脸80M，语音70M，卧槽人傻了，这个APP起码有200M，难玩啊")]),t._v(" "),s("p",[t._v("想省掉谷歌内核，但是一体机得装谷歌浏览器，体验不太好，还是嵌入吧")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228180704921.png",alt:"image-20211228180704921"}})]),t._v(" "),s("h2",{attrs:{id:"_4-呼叫流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-呼叫流程"}},[t._v("#")]),t._v(" 4.呼叫流程")]),t._v(" "),s("p",[t._v("正常的呼叫流程，113是电脑，119是安卓一体机，安卓呼叫电脑可以，看下nodejs打印的日志")]),t._v(" "),s("p",[t._v("apply  192.168.0.113\nreply  192.168.0.119\n1v1offer 192.168.0.113\n1v1ICE  192.168.0.113\n1v1ICE  192.168.0.113\n1v1ICE  192.168.0.113\n1v1ICE  192.168.0.113\n1v1answer  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1hangup  192.168.0.119")]),t._v(" "),s("p",[t._v("坑点：电脑呼叫安卓无法接通")]),t._v(" "),s("p",[t._v("apply  192.168.0.119\nreply  192.168.0.113\n1v1offer 192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1ICE  192.168.0.119\n1v1hangup  192.168.0.119")]),t._v(" "),s("p",[t._v("可以看到安卓接收到1v1offer 之后没有1v1answer ，在androidstudio的logcat中可以发现")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211230120048366.png",alt:"image-20211230120048366"}})]),t._v(" "),s("p",[t._v("蛋疼，app嵌入谷歌内核还是有问题啊，怎么办啊")]),t._v(" "),s("p",[t._v("可以看得出来1v1answer的时候，设置远程描述挂了，还是底层动态库报错，我也无奈啊")]),t._v(" "),s("p",[t._v("果断放弃")]),t._v(" "),s("div",{staticClass:"language-groovy line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-groovy"}},[s("code",[t._v("implementation "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.xwalk:xwalk_core_library:23.53.589.4'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("真坑爹")]),t._v(" "),s("p",[t._v("最新的谷歌内核都救不了")]),t._v(" "),s("p",[t._v("下载地址：[https://download.01.org/crosswalk/releases/crosswalk/android/maven2/org/xwalk/xwalk_core_library/]")]),t._v(" "),s("p",[t._v("[(https://download.01.org/crosswalk/releases/crosswalk/android/maven2/org/xwalk/xwalk_core_library/)")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231165812795.png",alt:"image-20211231165812795"}})]),t._v(" "),s("p",[t._v("直接用官网的sdk还是加载不了假的https，我也是醉了")]),t._v(" "),s("p",[t._v("没办法")]),t._v(" "),s("p",[t._v("只能下载下来，修改jar，不拦截ssl")]),t._v(" "),s("p",[t._v("好了，现在网页可以加载了，但是测试发现，只能一体机打电话给电脑，电脑无法打通一体机，坑爹，如果领导能接受这样，那就不用搞那么多了")]),t._v(" "),s("p",[t._v("一体机下载最新的谷歌浏览器app吧，管不了那么多了")]),t._v(" "),s("h2",{attrs:{id:"_5-js踩坑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-js踩坑"}},[t._v("#")]),t._v(" 5.js踩坑")]),t._v(" "),s("p",[t._v("这个socket的连接断开可以在app.vue里面监听，就可以用vuebus了")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231171627490.png",alt:"image-20211231171627490"}})]),t._v(" "),s("p",[t._v("最令人吐槽的是function里面还不能用this，用ES6的写法才可以")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231171729091.png",alt:"image-20211231171729091"}})]),t._v(" "),s("p",[t._v("数组遍历forEach")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231171856862.png",alt:"image-20211231171856862"}})]),t._v(" "),s("p",[t._v("卧槽，对象里面存数组，狗屎")]),t._v(" "),s("p",[t._v("const users = {};")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231171946336.png",alt:"image-20211231171946336"}})]),t._v(" "),s("h2",{attrs:{id:"_6-呼叫优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-呼叫优化"}},[t._v("#")]),t._v(" 6.呼叫优化")]),t._v(" "),s("p",[t._v("当一体机没打开网页时，我们电脑上点击视频通话，打电话给一体机，一体机接收到消息，打开默认浏览器（安装并设置默认谷歌浏览）需要一段时间，需要不停的发送apply")]),t._v(" "),s("p",[t._v("一体机接收到了apply，回复4，表示接收到了，电脑端就需要清除定时器，不能再发送apply，否则会接收到3，正在视频通话，就会直接挂掉电话")]),t._v(" "),s("p",[t._v("如果再次接收到apply，回复3,，正在视频通话")]),t._v(" "),s("h2",{attrs:{id:"_7-socket断开监听"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-socket断开监听"}},[t._v("#")]),t._v(" 7.socket断开监听")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231172840287.png",alt:"image-20211231172840287"}})]),t._v(" "),s("p",[t._v("把断开的踢掉，剩下的就是在线人数")]),t._v(" "),s("h2",{attrs:{id:"_8-加入房间优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-加入房间优化"}},[t._v("#")]),t._v(" 8.加入房间优化")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231173055152.png",alt:"image-20211231173055152"}})]),t._v(" "),s("p",[t._v("先把自己踢出，然后再次加入，用最新的连接")]),t._v(" "),s("h2",{attrs:{id:"_9-代码优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-代码优化"}},[t._v("#")]),t._v(" 9.代码优化")]),t._v(" "),s("p",[s("strong",[t._v("1.方法调用顺序")])]),t._v(" "),s("p",[s("strong",[t._v("2.删除没用的成员变量")])]),t._v(" "),s("p",[s("strong",[t._v("3.方法名称修改得更贴近功能")])]),t._v(" "),s("p",[s("strong",[t._v("4.注意回调中的错误处理")])]),t._v(" "),s("h2",{attrs:{id:"_10-打包发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-打包发布"}},[t._v("#")]),t._v(" 10.打包发布")]),t._v(" "),s("p",[t._v("先关掉nginx，复制打包后的static文件夹和index.html，再次打开nginx，就这样吧")])])}),[],!1,null,null,null);a.default=e.exports}}]);