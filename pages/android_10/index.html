<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>视频通话测试踩坑 | wyb&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/blog/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="主流技术博客,简洁至上,专注全栈学习与总结。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/blog/assets/css/0.styles.7dd69afa.css" as="style"><link rel="preload" href="/blog/assets/js/app.7a0bcda5.js" as="script"><link rel="preload" href="/blog/assets/js/2.a5a0f980.js" as="script"><link rel="preload" href="/blog/assets/js/17.0053c99b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.2ffa04b0.js"><link rel="prefetch" href="/blog/assets/js/11.70f92a32.js"><link rel="prefetch" href="/blog/assets/js/12.340f549c.js"><link rel="prefetch" href="/blog/assets/js/13.9e5f7372.js"><link rel="prefetch" href="/blog/assets/js/14.b9340184.js"><link rel="prefetch" href="/blog/assets/js/15.6c1f35df.js"><link rel="prefetch" href="/blog/assets/js/16.e3c6e4ef.js"><link rel="prefetch" href="/blog/assets/js/18.45a0f3ed.js"><link rel="prefetch" href="/blog/assets/js/19.fb9cc485.js"><link rel="prefetch" href="/blog/assets/js/20.3d5c7a50.js"><link rel="prefetch" href="/blog/assets/js/21.3d0ee275.js"><link rel="prefetch" href="/blog/assets/js/22.e8a9df9a.js"><link rel="prefetch" href="/blog/assets/js/23.82ed3e72.js"><link rel="prefetch" href="/blog/assets/js/24.9d7a7b68.js"><link rel="prefetch" href="/blog/assets/js/25.0bc9ab07.js"><link rel="prefetch" href="/blog/assets/js/26.d2b7a967.js"><link rel="prefetch" href="/blog/assets/js/27.2c02fa2c.js"><link rel="prefetch" href="/blog/assets/js/28.a1afa2d7.js"><link rel="prefetch" href="/blog/assets/js/29.10d9dc2f.js"><link rel="prefetch" href="/blog/assets/js/3.8ec5b007.js"><link rel="prefetch" href="/blog/assets/js/30.425d8100.js"><link rel="prefetch" href="/blog/assets/js/31.63e4f8fb.js"><link rel="prefetch" href="/blog/assets/js/32.77a66ca1.js"><link rel="prefetch" href="/blog/assets/js/33.d0e23080.js"><link rel="prefetch" href="/blog/assets/js/34.1e204563.js"><link rel="prefetch" href="/blog/assets/js/35.2833874a.js"><link rel="prefetch" href="/blog/assets/js/36.97de71b1.js"><link rel="prefetch" href="/blog/assets/js/37.9036f6e9.js"><link rel="prefetch" href="/blog/assets/js/38.6793c03d.js"><link rel="prefetch" href="/blog/assets/js/39.849e03fc.js"><link rel="prefetch" href="/blog/assets/js/4.6e55e017.js"><link rel="prefetch" href="/blog/assets/js/40.56980ac8.js"><link rel="prefetch" href="/blog/assets/js/41.7a196738.js"><link rel="prefetch" href="/blog/assets/js/42.10732ea3.js"><link rel="prefetch" href="/blog/assets/js/43.810ba5a4.js"><link rel="prefetch" href="/blog/assets/js/44.73bbd126.js"><link rel="prefetch" href="/blog/assets/js/45.63b7b5a1.js"><link rel="prefetch" href="/blog/assets/js/46.a65e64ce.js"><link rel="prefetch" href="/blog/assets/js/47.00dc050a.js"><link rel="prefetch" href="/blog/assets/js/48.b91a0ddd.js"><link rel="prefetch" href="/blog/assets/js/49.4a16d835.js"><link rel="prefetch" href="/blog/assets/js/5.4843dc8e.js"><link rel="prefetch" href="/blog/assets/js/50.132e204b.js"><link rel="prefetch" href="/blog/assets/js/51.1345b9a1.js"><link rel="prefetch" href="/blog/assets/js/52.742ee8db.js"><link rel="prefetch" href="/blog/assets/js/53.8d9c7dd6.js"><link rel="prefetch" href="/blog/assets/js/54.c4038d3f.js"><link rel="prefetch" href="/blog/assets/js/55.766e53e6.js"><link rel="prefetch" href="/blog/assets/js/56.ad60a3d1.js"><link rel="prefetch" href="/blog/assets/js/57.13758d00.js"><link rel="prefetch" href="/blog/assets/js/58.ee3f65e8.js"><link rel="prefetch" href="/blog/assets/js/59.602af4ee.js"><link rel="prefetch" href="/blog/assets/js/6.da76d55e.js"><link rel="prefetch" href="/blog/assets/js/60.15e31058.js"><link rel="prefetch" href="/blog/assets/js/61.7f219b23.js"><link rel="prefetch" href="/blog/assets/js/62.10d98d67.js"><link rel="prefetch" href="/blog/assets/js/63.8ef0d49d.js"><link rel="prefetch" href="/blog/assets/js/64.983ab7ac.js"><link rel="prefetch" href="/blog/assets/js/65.37330ddf.js"><link rel="prefetch" href="/blog/assets/js/66.2776a634.js"><link rel="prefetch" href="/blog/assets/js/67.8b5b3535.js"><link rel="prefetch" href="/blog/assets/js/68.cccc4d3a.js"><link rel="prefetch" href="/blog/assets/js/7.ba6e6c9a.js"><link rel="prefetch" href="/blog/assets/js/8.99b38245.js"><link rel="prefetch" href="/blog/assets/js/9.fc8f51e1.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.7dd69afa.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/EB-logo.png" alt="wyb's blog" class="logo"> <span class="site-name can-hide">wyb's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div> <a href="https://github.com/wyba/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/lufei.jpeg"> <div class="blogger-info"><h3>wyb</h3> <span>吾日三省吾身</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div> <a href="https://github.com/wyba/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/blog/pages/android_1/" class="sidebar-link">科大讯飞SDK使用总结</a></li><li><a href="/blog/pages/android_2/" class="sidebar-link">PDA串口UnsatisfiedLinkError解决</a></li><li><a href="/blog/pages/android_3/" class="sidebar-link">科大讯飞声纹识别WebApi鉴权认证失败解决</a></li><li><a href="/blog/pages/android_4/" class="sidebar-link">Android获取以太网mac、ip、网关、子网掩码</a></li><li><a href="/blog/pages/android_5/" class="sidebar-link">Android科大讯飞离线命令词+声纹识别终极奥义</a></li><li><a href="/blog/pages/android_6/" class="sidebar-link">Android物联网三年开发总结</a></li><li><a href="/blog/pages/android_7/" class="sidebar-link">BaseFragment封装</a></li><li><a href="/blog/pages/android_8/" class="sidebar-link">File封装</a></li><li><a href="/blog/pages/android_9/" class="sidebar-link">AndroidX项目迁移</a></li><li><a href="/blog/pages/android_10/" aria-current="page" class="active sidebar-link">视频通话测试踩坑</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_1-运行本地工程" class="sidebar-link">1.运行本地工程</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_2-使用谷歌浏览器测试" class="sidebar-link">2.使用谷歌浏览器测试</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_3-app嵌入谷歌内核-从执着到放弃" class="sidebar-link">3.App嵌入谷歌内核（从执着到放弃）</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_4-呼叫流程" class="sidebar-link">4.呼叫流程</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_5-js踩坑" class="sidebar-link">5.js踩坑</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_6-呼叫优化" class="sidebar-link">6.呼叫优化</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_7-socket断开监听" class="sidebar-link">7.socket断开监听</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_8-加入房间优化" class="sidebar-link">8.加入房间优化</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_9-代码优化" class="sidebar-link">9.代码优化</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/android_10/#_10-打包发布" class="sidebar-link">10.打包发布</a></li></ul></li><li><a href="/blog/pages/a9e14e/" class="sidebar-link">Android Jetpack简介</a></li><li><a href="/blog/pages/2ebf62/" class="sidebar-link">Android Jetpack+MVVM</a></li><li><a href="/blog/pages/874c9e/" class="sidebar-link">Androidx分包</a></li><li><a href="/blog/pages/066351/" class="sidebar-link">Android性能优化</a></li><li><a href="/blog/pages/bac66b/" class="sidebar-link">Android Activity</a></li><li><a href="/blog/pages/08ee91/" class="sidebar-link">Android BroadcastReceiver</a></li><li><a href="/blog/pages/6f10c5/" class="sidebar-link">Android Service</a></li><li><a href="/blog/pages/7284b2/" class="sidebar-link">Android ContentProvider</a></li><li><a href="/blog/pages/14545c/" class="sidebar-link">Android Fragment</a></li><li><a href="/blog/pages/004b87/" class="sidebar-link">Android序列化</a></li><li><a href="/blog/pages/7b3423/" class="sidebar-link">View事件机制</a></li><li><a href="/blog/pages/420b54/" class="sidebar-link">多进程及IPC</a></li><li><a href="/blog/pages/e86925/" class="sidebar-link">Bitmap加载优化</a></li><li><a href="/blog/pages/b906ee/" class="sidebar-link">ListView原理及复用机制</a></li><li><a href="/blog/pages/19c834/" class="sidebar-link">OkHttp原理</a></li><li><a href="/blog/pages/e5b1b5/" class="sidebar-link">EventBus原理</a></li><li><a href="/blog/pages/37f9d7/" class="sidebar-link">MeasureSpec原理</a></li><li><a href="/blog/pages/99060e/" class="sidebar-link">View工作流程</a></li><li><a href="/blog/pages/8aff38/" class="sidebar-link">动画简介</a></li><li><a href="/blog/pages/af8584/" class="sidebar-link">BLE开发</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/blog/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/blog/Android/#Android" data-v-1baff76c>Android</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>wyb</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2021-12-31</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">视频通话测试踩坑<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><blockquote><p>说明：我们用webrtc做视频通话，每次测试都很头疼，2021年的最后一篇文章。</p></blockquote> <h2 id="_1-运行本地工程"><a href="#_1-运行本地工程" class="header-anchor">#</a> 1.运行本地工程</h2> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228172226534.png" alt="image-20211228172226534"></p> <p>这个工程由nodejs+vue组合</p> <p>webrtc-main文件夹是一个vue工程，视频通话界面</p> <p>facewebrtc文件夹是一个nodejs工程，做信令服务器使用</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228172443069.png" alt="image-20211228172443069"></p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228172510154.png" alt="image-20211228172510154"></p> <p>vue.config.js配置本机ip</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228172635360.png" alt="image-20211228172635360"></p> <p>开启上位机，开始测试</p> <p>网站必须是<strong>https</strong>，https可以获取到摄像头和麦克风权限，没办法，而且https是针对每台电脑，如果是http的话只能是本机服务器上(nginx所在的电脑)的浏览器可以使用，其他电脑无法使用webrtc，显然这是不合理的，所以不使用http</p> <p>vue本地调试配置https</p> <p>nginx要自签名的https，也就是假的https，因为真正的https是需要公网的IP或者域名，我们的视频通话是内网的，所以只能用自签名的证书，假的https打开网页时不受信任，我们需要点击高级，接收风险才行，接受一次就可以了</p> <p><strong>socketio也要代理，并且接受信任</strong></p> <p>先本地调试，调试好了之后就部署到nginx，然后测试，没问题就大功告成！！！</p> <p>测试需要谷歌浏览器，最新的谷歌浏览器，别的不支持哈！！！</p> <h2 id="_2-使用谷歌浏览器测试"><a href="#_2-使用谷歌浏览器测试" class="header-anchor">#</a> 2.使用谷歌浏览器测试</h2> <p>打开网页获取不到本机ip，需要配置</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228173122012.png" alt="image-20211228173122012"></p> <p>坑啊，为啥会查出多个ip</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228174356891.png" alt="image-20211228174356891"></p> <p>母鸡母鸡啊</p> <h2 id="_3-app嵌入谷歌内核-从执着到放弃"><a href="#_3-app嵌入谷歌内核-从执着到放弃" class="header-anchor">#</a> 3.App嵌入谷歌内核（从执着到放弃）</h2> <p>卧槽，谷歌内核有38M的SDK，人脸80M，语音70M，卧槽人傻了，这个APP起码有200M，难玩啊</p> <p>想省掉谷歌内核，但是一体机得装谷歌浏览器，体验不太好，还是嵌入吧</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211228180704921.png" alt="image-20211228180704921"></p> <h2 id="_4-呼叫流程"><a href="#_4-呼叫流程" class="header-anchor">#</a> 4.呼叫流程</h2> <p>正常的呼叫流程，113是电脑，119是安卓一体机，安卓呼叫电脑可以，看下nodejs打印的日志</p> <p>apply  192.168.0.113
reply  192.168.0.119
1v1offer 192.168.0.113
1v1ICE  192.168.0.113
1v1ICE  192.168.0.113
1v1ICE  192.168.0.113
1v1ICE  192.168.0.113
1v1answer  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1hangup  192.168.0.119</p> <p>坑点：电脑呼叫安卓无法接通</p> <p>apply  192.168.0.119
reply  192.168.0.113
1v1offer 192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1ICE  192.168.0.119
1v1hangup  192.168.0.119</p> <p>可以看到安卓接收到1v1offer 之后没有1v1answer ，在androidstudio的logcat中可以发现</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211230120048366.png" alt="image-20211230120048366"></p> <p>蛋疼，app嵌入谷歌内核还是有问题啊，怎么办啊</p> <p>可以看得出来1v1answer的时候，设置远程描述挂了，还是底层动态库报错，我也无奈啊</p> <p>果断放弃</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>implementation <span class="token string">'org.xwalk:xwalk_core_library:23.53.589.4'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>真坑爹</p> <p>最新的谷歌内核都救不了</p> <p>下载地址：[https://download.01.org/crosswalk/releases/crosswalk/android/maven2/org/xwalk/xwalk_core_library/]</p> <p>[(https://download.01.org/crosswalk/releases/crosswalk/android/maven2/org/xwalk/xwalk_core_library/)</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231165812795.png" alt="image-20211231165812795"></p> <p>直接用官网的sdk还是加载不了假的https，我也是醉了</p> <p>没办法</p> <p>只能下载下来，修改jar，不拦截ssl</p> <p>好了，现在网页可以加载了，但是测试发现，只能一体机打电话给电脑，电脑无法打通一体机，坑爹，如果领导能接受这样，那就不用搞那么多了</p> <p>一体机下载最新的谷歌浏览器app吧，管不了那么多了</p> <h2 id="_5-js踩坑"><a href="#_5-js踩坑" class="header-anchor">#</a> 5.js踩坑</h2> <p>这个socket的连接断开可以在app.vue里面监听，就可以用vuebus了</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231171627490.png" alt="image-20211231171627490"></p> <p>最令人吐槽的是function里面还不能用this，用ES6的写法才可以</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231171729091.png" alt="image-20211231171729091"></p> <p>数组遍历forEach</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231171856862.png" alt="image-20211231171856862"></p> <p>卧槽，对象里面存数组，狗屎</p> <p>const users = {};</p> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231171946336.png" alt="image-20211231171946336"></p> <h2 id="_6-呼叫优化"><a href="#_6-呼叫优化" class="header-anchor">#</a> 6.呼叫优化</h2> <p>当一体机没打开网页时，我们电脑上点击视频通话，打电话给一体机，一体机接收到消息，打开默认浏览器（安装并设置默认谷歌浏览）需要一段时间，需要不停的发送apply</p> <p>一体机接收到了apply，回复4，表示接收到了，电脑端就需要清除定时器，不能再发送apply，否则会接收到3，正在视频通话，就会直接挂掉电话</p> <p>如果再次接收到apply，回复3,，正在视频通话</p> <h2 id="_7-socket断开监听"><a href="#_7-socket断开监听" class="header-anchor">#</a> 7.socket断开监听</h2> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231172840287.png" alt="image-20211231172840287"></p> <p>把断开的踢掉，剩下的就是在线人数</p> <h2 id="_8-加入房间优化"><a href="#_8-加入房间优化" class="header-anchor">#</a> 8.加入房间优化</h2> <p><img src="https://cdn.jsdelivr.net/gh/wyba/image_store/blog/image-20211231173055152.png" alt="image-20211231173055152"></p> <p>先把自己踢出，然后再次加入，用最新的连接</p> <h2 id="_9-代码优化"><a href="#_9-代码优化" class="header-anchor">#</a> 9.代码优化</h2> <p><strong>1.方法调用顺序</strong></p> <p><strong>2.删除没用的成员变量</strong></p> <p><strong>3.方法名称修改得更贴近功能</strong></p> <p><strong>4.注意回调中的错误处理</strong></p> <h2 id="_10-打包发布"><a href="#_10-打包发布" class="header-anchor">#</a> 10.打包发布</h2> <p>先关掉nginx，复制打包后的static文件夹和index.html，再次打开nginx，就这样吧</p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/wyba/blog/edit/master/docs/01.Android/10.视频通话测试踩坑.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/blog/tags/?tag=%E8%A7%86%E9%A2%91%E9%80%9A%E8%AF%9D" title="标签">#视频通话</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/12/31, 17:40:39</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/blog/pages/android_9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">AndroidX项目迁移</div></a> <a href="/blog/pages/a9e14e/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Android Jetpack简介</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/pages/android_9/" class="prev">AndroidX项目迁移</a></span> <span class="next"><a href="/blog/pages/a9e14e/">Android Jetpack简介</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/blog/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blog/pages/af8584/"><div>
            BLE开发
            <!----></div></a> <span class="date">04-29</span></dt></dl><dl><dd>02</dd> <dt><a href="/blog/pages/8aff38/"><div>
            动画简介
            <!----></div></a> <span class="date">04-29</span></dt></dl><dl><dd>03</dd> <dt><a href="/blog/pages/99060e/"><div>
            View工作流程
            <!----></div></a> <span class="date">04-29</span></dt></dl> <dl><dd></dd> <dt><a href="/blog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1070096495@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wyba" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>wyb | <a href="https://github.com/wyba/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/blog/assets/js/app.7a0bcda5.js" defer></script><script src="/blog/assets/js/2.a5a0f980.js" defer></script><script src="/blog/assets/js/17.0053c99b.js" defer></script>
  </body>
</html>
